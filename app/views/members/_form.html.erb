<%= form_for setup_member_instruments(@member) do |f| %>
  <% if member.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(member.errors.count, "error") %> prohibited this member from being saved:</h2>

      <ul>
      <% member.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <table>
    <tr>
      <td>
        <div class="field">
          <%= f.label :first_name, "First Name" %>
          <%= f.text_field :first_name %>
        </div>
      </td>
      <td>
        <div class="field">
          <%= f.label :last_name, "Last Name" %>
          <%= f.text_field :last_name %>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="field">
          <%= f.label :address_1, "Address Row 1" %>
          <%= f.text_field :address_1 %>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="field">
          <%= f.label :address_2, "Address Row 2" %>
          <%= f.text_field :address_2 %>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="field">
          <%= f.label :city %>
          <%= f.text_field :city %>
        </div>
      </td>
      <td>

        <div class="field inlineField">
          <%= f.label :state %>
          <%= f.select :state, options_for_select(us_states, selected: 'CA') %>
        </div>

        <div class="field inlineField">
          <%= f.label :zip %>
          <%= f.text_field :zip, size: 5 %>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="field">
          <%= f.label :phone_1, "Primary Phone" %>
          <%= f.text_field :phone_1 %>
        </div>
      </td>
      <td>

        <div class="field">
          <%= f.label :phone_1_type, "Primary Phone Type" %>
          <%= f.select :phone_1_type, ['', 'Cell Phone', 'Home', 'Business', 'Other'] %>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="field">
          <%= f.label :phone_2, "Secondary Phone" %>
          <%= f.text_field :phone_2 %>
        </div>
      </td>
      <td>
        <div class="field">
          <%= f.label :phone_2_type, "Secondary Phone Type" %>
          <%= f.select :phone_2_type, ['', 'Cell Phone', 'Home', 'Business', 'Other'] %>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="field">
          <%= f.label :email_1, "Primary Email Address" %>
          <%= f.text_field :email_1 %>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="field">
          <%= f.label :email_2, "Secondary Email Address" %>
          <%= f.text_field :email_2 %>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan=2>
        <div class="field">
          <%= f.label :initial_date, "Initial Contact Date  (use date picker or in format YYYY-MM-DD)" %>
          <%= date_field :member, :initial_date %>
        </div>
      </td>
    </tr>
    <tr>
      <td>
        <div class="field">
          <%= f.label :playing_status, "Overall Status" %>
          <%= f.text_field :playing_status %>
        </div>
      </td>
    </tr>
    <tr>
      <td>


        <div class="field">
          <b>Emergency Contact Information</b><br>
          <%= f.label :emergency_name, "Name" %>
          <%= f.text_field :emergency_name %>
        </div>
      </td>
      <td>
        <br>
        <div class="field inlineField">
          <%= f.label :emergency_relation, "Relationship to Member" %>
          <%= f.text_field :emergency_relation %>
        </div>
        <div class="field inlineField">
          <%= f.label :emergency_phone, "Phone Number" %>
          <%= f.text_field :emergency_phone %>
        </div>
      </td>
    </tr>
    <tr>
      <td>


      </td>
    </tr>
  </table>

  <script>var instCount = <%= [@member.member_instruments.count - 1, 1].max %>;</script>
  <b>Instruments</b> <br>
  <% i = 0 %>
  <%= f.fields_for :member_instruments do |instrument_f| %>
    <% if i < @member.member_instruments.count || i == 0 %>
      <div class="field">
        <%= instrument_f.text_field :instrument %> <i><a href='#' id='removeMemberInstrument<%=i%>'>Remove</a></i>
      </div>
    <% end %>
    <% i += 1; %>
  <% end %>
  <i><a href='#' id='addNewMemberInstrument'> + Add Instrument</a></i><br><br>


  <script>var setCount = <%= [@member.member_sets.count - 1, 1].max %>;</script>
  <b>Sets</b> <br>
  <% j = 0 %>
  <%= f.fields_for :member_sets do |set_f| %>
    <% if j < @member.member_sets.count || j == 0 %>
      <div class="field striped">
        <%= set_f.collection_select :set_id, @sets, :id, :name, { prompt: true, :selected => set_f.object.set_id ? set_f.object.set_id.to_i : nil } %>
        &emsp;
        Status:
        <%= set_f.text_field :set_status %>
        &emsp;
        Rotating this set? <%= set_f.check_box :rotating %>
        &emsp;
        <% x = 0 %>
        <%= set_f.fields_for :set_member_instruments do |smi_f| %>
          <% if x < set_f.object.set_member_instruments.count || x == 0 %>
            <%= smi_f.collection_select :member_instrument_id, @member_instruments, :id, :instrument, { prompt: true } %>
          <% end %>
        <% end %>
        &emsp;
        <i><a href='#' id='removeMemberSet<%=j%>'>Remove</a></i>
      </div>
    <% end %>
    <% j += 1 %>
  <% end %>
  <i><a href='#' id='addNewMemberSet'> + Add Set</a></i><br><br>

  <script>var notesCount = <%= [@member.member_notes.count - 1, 1].max %>;</script>
  <b>Notes</b> <br>
  <% k = 0 %>
  <%= f.fields_for :member_notes do |note_f| %>
    <% if k < @member.member_notes.count || k == 0 %>
      <div class="field">
        <%= note_f.text_field :note %> <i><a href='#' id='removeMemberNote<%=k%>'>Remove</a></i>

      </div>
    <% end %>
    <% k += 1; %>
  <% end %>
  <i><a href='#' id='addNewMemberNote'> + Add Note</a></i><br><br>

  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>
